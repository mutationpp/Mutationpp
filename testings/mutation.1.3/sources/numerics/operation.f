C-----------------------------------------------------------------------
      FUNCTION DDDOT(N,X,A,Y,B)
C-----------------------------------------------------------------------
C     Scalar product 
C-----------------------------------------------------------------------
      IMPLICIT NONE
      INTEGER N, A, B
      DOUBLE PRECISION X(N), Y(N)
C-----------------------------------------------------------------------
      INTEGER I
      DOUBLE PRECISION  PRODUCT, DDDOT
C-----------------------------------------------------------------------
      PRODUCT = 0.D0
      DO I = 1, N
        PRODUCT = PRODUCT + X(I) *Y(I)
      ENDDO
      DDDOT = PRODUCT
      END FUNCTION DDDOT
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
      SUBROUTINE SYMMATVEC (N, A, X, B)
C-----------------------------------------------------------------------
C     Symmetric matrix vector product
C-----------------------------------------------------------------------
      IMPLICIT NONE
      INTEGER N
      DOUBLE PRECISION A(1:N*(N+1)/2), X(1:N) ,B(1:N)
C-----------------------------------------------------------------------
      INTEGER I, J, IJ
C-----------------------------------------------------------------------
      DO I = 1, N
        B(I) = 0.D0
        DO J = 1, I-1 
          IJ = ((J-1)*(2*N-J)+2*I)/2 
          B(I) = B(I) +A(IJ) *X(J)
        ENDDO
        DO J = I, N
          IJ = ((I-1)*(2*N-I)+2*J)/2 
          B(I) = B(I) +A(IJ) *X(J)
        ENDDO
      ENDDO

      END SUBROUTINE SYMMATVEC
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
      SUBROUTINE MATVEC (N, A, X, B)
C-----------------------------------------------------------------------
C     Matrix vector product
C-----------------------------------------------------------------------
      IMPLICIT NONE
      INTEGER N
      DOUBLE PRECISION A(1:N,1:N), X(1:N) ,B(1:N)
C-----------------------------------------------------------------------
      INTEGER I, J, IJ
C-----------------------------------------------------------------------
      DO I = 1, N
        B(I) = 0.D0
        DO J = 1, N
          B(I) = B(I) +A(I,J) *X(J)
        ENDDO
      ENDDO

      END SUBROUTINE MATVEC
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
      SUBROUTINE EGSAXS ( N, A, X, B )
C-----------------------------------------------------------------------
C     Matrix vector multiplication (EGSLIB)
C-----------------------------------------------------------------------
C                             B == A.X
C
C     The matrix A is stored in symmetric form, i.e., instead of
C     A(i,j) we store A(n*(i-1) - i*(i-1)/2 + j)
C-----------------------------------------------------------------------
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      IMPLICIT INTEGER (I-N)
      DIMENSION A(*), X(N), B(N)
C-----------------------------------------------------------------------
      DO 10 I = 1, N
         III = N*(I-1) - (I*(I-1))/2 + I
         B(I) = A(III) * X(I)
10    CONTINUE
      DO 30 I = 1, N
         DO 20 J = I+1, N
            III = N*(I-1) - (I*(I-1))/2 + J
            B(I) = B(I) + A(III)*X(J)
            B(J) = B(J) + A(III)*X(I)
20       CONTINUE
30    CONTINUE
      RETURN
      END
C-----------------------------------------------------------------------

